# ИДЗ4
## Стек
Язык программирования: `Python 3`

Фреймворк: `Flask`, 

СУБД: `MySQL`

Отправка REST запросов : `Postman`

## Архитектура 
Приложение состоит из двух глобальных микросервисов - `OrdersMicroservice` и `UsersMicroservice`, каждый из которых реализует интерфейс `MicroserviceInterface` и использует несколько компонентов, реализующий интерфейс `MicroserviceComponentInterface`. Они отвечают за взаимодействие с заказами/меню и пользователями соответственно.
Оба микросервиса можно запустить отдельно друг друга (хотя смысла от использования, конечно, не будет). Обмениваются данными микросервисы через таблицы БД, не зная о существовании друг друга.
##### Примечание
Большинство запросов валидируется на корректность данных. Для некоторых запросов необходим jwt-токен.

## Работа программы
### UsersMicroservice
Располагается по адресу: `http://127.0.0.1:5000`

* Регистрация:
Для регистрации нового пользователя необходимо отправить `POST` или `GET` запрос (в случае последнего будет возвращена POST-форма) , содержащий json с необходимой информацией по адресу `/signup`. Поле `role` является опциональным и по умолчанию устанавливается в `customer`. Пример запроса:
```json
{
    "username" : "root3",
    "email" : "root3@gmail.com",
    "password" : "kamkino123",
    "role" : "manager"
}
```
Сервер обрабатывает значение и в случае успеха вносит пользователя в базу данных

* Авторизация:
С данными из пункта выше (имя пользователя и пароль) пользователь может войти в систему, отправив `POST` запрос по адресу `/signin` :
```json
{
    "username" : "root",
    "password" : "kamkino123"
}
```
В случае успешного входа пользователю вернется JWT-токен, например:
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiIxIiwiZXhwIjoxNjg1Mzk2MjEzfQ.V2yJSSUD9B0odmCT9eQUcjlzUD0orh4O0unkZwqnxl4
```
Этот токен требуется во многих запросах, его нужно указывать как параметр запроса, то есть делать запросы вида `/action?token=my_token`
С помощью него осуществляется аутентификация доступа к системе и чтение роли.

* Получение данных о пользователе:
Пользователь может получить информацию о себе по свежему токену. Для этого нужно отправить `GET` запрос по адресу `/getinfo?token=user_token`

### OrdersMicroservice
##### Меню + заказы
Располагается по адресу: `http://127.0.0.1:5000`
* Получение меню:
Пользователь может получить данные о всех доступных для заказа позициях меню. Для этого нужно сделать пустой `GET` запрос на адрес `/getmenu` 

* Создание заказа:
Для создания заказа на адрес `makeorder` через `POST` отправляется запрос вида:
```json
{
    "user_id" : 1,
    "special_requests" : "Some",
    "dishes" : {
        "Лазанья аль форно" : 1
    }
}
```

* Получение данных о заказе:
Можно получить полную информацию о любом (не только о своём) заказе c помощью `GET` запроса по адресу `/getorder`, передав ID заказа:
```json
{
    "id": "22C93042-7DDD-423C-86BD-A71D5AD04DC7"
}
```

##### Блюда
Для того, чтобы создавать/удалять блюда нужно иметь роль `chef`, а чтобы менять цену/количество `manager` (эдакое разделение обязанностей).

* Создание блюда:
По адресу `appenddish` через `POST` запрос нужно послать json:
```json
{
    "name" : "i_am_a_new_dish",
    "description" : "i_am_a_new_description",
    "price" : 140,
    "quantity" : 10
}
```

* Удаление блюда:
На адрес `/removedish` отправляется `POST` запрос, содержащий id блюда:
```json
{
    "id" : 134
}
```

* Обновление информации о блюде:
Для выполнения этих действий менеджер должен отправить `PATCH` запросу по адресу `/changeprice` или `/changequantity` с телом:
```json
{
    "id" : 1,
    "new_price" : 100
}
```
или
```json
{
    "id" : 1,
    "new_quantity" : 10
}
```

## JWT Token
После регистрации пользователя ему __необходимо__ авторизоваться, только тогда он получит свой `JWT-токен`.
`Payload` токена пользователя хранит теги:
* `id` - уникальный идентификатор пользователя
* `exp` - дата истечения токена (каждый токен протухает через сутки)